{% extends "base.html" %}
{% block head_title %}{{ prize.name }}{% endblock head_title %}

{% block content %}
<div class="container mt-5" style="max-width: 900px;">
  <div class="d-flex align-items-center justify-content-between mb-4">
    <a href="{% url 'rewards:prize_list' %}" class="btn btn-outline-secondary btn-sm">
      ← Back to prizes
    </a>
    <a class="btn btn-outline-light btn-sm" href="{% url 'rewards:my_redemptions' %}">
      My redemptions
    </a>
    <div class="text-end">
      <div class="small text-secondary">Your points</div>
      <div class="fs-4 fw-semibold">{{ request.user.points }}</div>
    </div>
  </div>

  {% if messages %}
    {% for message in messages %}
      <div class="alert alert-{{ message.tags }}">{% if message %}{{ message }}{% endif %}</div>
    {% endfor %}
  {% endif %}

  <div class="card bg-dark text-light border-secondary">
    <div class="row g-0">
      <div class="col-md-5">
        {% if prize.image %}
          <img src="{{ prize.image.url }}" class="img-fluid rounded-start"
               alt="{{ prize.name }}" style="height:100%;object-fit:cover;">
        {% else %}
          <div class="d-flex align-items-center justify-content-center text-secondary"
               style="height: 100%; min-height: 280px; background:#222;">
            <i class="bi bi-gift" style="font-size: 3rem;"></i>
          </div>
        {% endif %}
      </div>
      <div class="col-md-7">
        <div class="card-body">
          <h3 class="card-title">{{ prize.name }}</h3>
          <p class="text-secondary">{{ prize.description }}</p>

          <div class="d-flex gap-2 align-items-center mb-3">
            <span class="badge text-bg-primary fs-6">{{ prize.points_cost }} pts</span>
            <span class="text-secondary small">
              {% if prize.stock is None %}
                Stock: unlimited
              {% else %}
                Stock: {{ prize.stock }}
              {% endif %}
            </span>
          </div>

          {% if request.user.points < prize.points_cost %}
            <div class="alert alert-warning">
              You don’t have enough points to redeem this prize.
            </div>
          {% endif %}

          <form method="post" action="{% url 'rewards:redeem_prize' prize.id %}">
            {% csrf_token %}
            <button class="btn btn-primary"
                    type="submit"
                    {% if request.user.points < prize.points_cost %}disabled{% endif %}>
              Redeem (creates a pending request)
            </button>
            <div class="text-secondary small mt-2">
              Admin will review and fulfill this request. You’ll see status later in your dashboard.
            </div>
          </form>

        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}