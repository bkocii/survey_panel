{% load static %}
{% load tailwind_tags %}


{# ------- CHOICES -------#}
<div id="choice-inline" class="space-y-4 hidden">
  <h2 class="text-lg font-medium text-gray-800">Choices</h2>
  {{ choice_inline.management_form }}

  <div id="choices-forms" class="space-y-4">
    {% for form in choice_inline %}
      <div class="p-4 border rounded bg-gray-50 dark:bg-gray-800 space-y-3">
        {% for field in form.visible_fields %}
          <div class="w-full border-gray-300 rounded shadow-sm">
            <label class="block text-sm font-medium dark:text-gray-200">{{ field.label }}</label>
            {{ field }}
            {% if field.help_text %}
              <p class="text-xs text-gray-500">{{ field.help_text }}</p>
            {% endif %}
          </div>
        {% endfor %}
      </div>
    {% endfor %}
  </div>

  <template id="choices-template">
    <div class="p-4 border rounded bg-gray-50 dark:bg-gray-800 space-y-3">
      <!-- Choice Text -->
      <div class="space-y-1">
        <label for="id_choices-__prefix__-text" class="block text-sm font-medium dark:text-gray-200">Text</label>
        <input type="text" name="choices-__prefix__-text" id="id_choices-__prefix__-text" class="w-full border-gray-300 rounded shadow-sm">
      </div>
      <!-- Choice Value -->
      <div class="space-y-1">
        <label for="id_choices-__prefix__-value" class="block text-sm font-medium dark:text-gray-200">Value</label>
        <input type="number" name="choices-__prefix__-value" id="id_choices-__prefix__-value" class="w-full border-gray-300 rounded shadow-sm">
      </div>
      <!-- Choice Next Question -->
      <div class="space-y-1">
        <label for="id_choices-__prefix__-next_question" class="block text-sm font-medium dark:text-gray-200">Next Question</label>
        <select name="choices-__prefix__-next_question" id="id_choices-__prefix__-next_question" class="w-full border-gray-300 rounded shadow-sm">
          <option value="">---------</option>
          {% for q in all_questions %}
            <option value="{{ q.id }}">{{ q.text|truncatewords:8 }}</option>
          {% endfor %}
        </select>
      </div>
      <!-- Choice Image -->
      <div class="space-y-1">
        <label for="id_choices-__prefix__-image" class="block text-sm font-medium dark:text-gray-200">Image</label>
        <input type="file" name="choices-__prefix__-image" id="id_choices-__prefix__-image" class="w-full">
      </div>
    </div>
  </template>

  <div class="flex gap-3">
    <button type="button" data-prefix="choices" class="add-form-btn text-blue-600 px-3 py-1 border border-blue-600 rounded hover:bg-blue-100">
      ➕ Add Choice
    </button>
    <button type="button" class="bulk-add-btn text-sm text-blue-700 underline" data-prefix="choices">
      Bulk Add
    </button>
  </div>
</div>

{# ------- MATRIX ROWS ------- #}
<div id="matrix-row-inline" class="space-y-4 hidden">
  <h2 class="text-lg font-medium text-gray-800">Matrix Rows</h2>
  {{ matrix_row_inline.management_form }}

  <div id="matrix_rows-forms" class="space-y-4">
    {% for form in matrix_row_inline %}
      <div class="p-4 border rounded bg-gray-50 dark:bg-gray-800 space-y-3">
        {% for field in form.visible_fields %}
          <div class="space-y-1">
            <label class="block text-sm font-medium dark:text-gray-200">{{ field.label }}</label>
            {{ field }}
            {% if field.help_text %}
              <p class="text-xs text-gray-500">{{ field.help_text }}</p>
            {% endif %}
          </div>
        {% endfor %}
      </div>
    {% endfor %}
  </div>

  <template id="matrix_rows-template">
    <div class="p-4 border rounded bg-gray-50 dark:bg-gray-800 space-y-3">
      <div class="space-y-1">
        <label for="id_matrix_rows-__prefix__-text" class="block text-sm font-medium dark:text-gray-200">Row Text</label>
        <input type="text" name="matrix_rows-__prefix__-text" id="id_matrix_rows-__prefix__-text" class="w-full border-gray-300 rounded shadow-sm">
      </div>
      <div class="space-y-1">
        <label for="id_matrix_rows-__prefix__-value" class="block text-sm font-medium dark:text-gray-200">Value</label>
        <input type="number" name="matrix_rows-__prefix__-value" id="id_matrix_rows-__prefix__-value" class="w-full border-gray-300 rounded shadow-sm">
      </div>
      <div class="space-y-1">
        <label class="inline-flex items-center">
          <input type="checkbox" name="matrix_rows-__prefix__-required" id="id_matrix_rows-__prefix__-required" class="mr-2">
          Required
        </label>
      </div>
      <div class="space-y-1">
        <label class="block text-sm font-medium dark:text-gray-200" for="id_matrix_rows-__prefix__-next_question">Next Question</label>
        <select name="matrix_rows-__prefix__-next_question" id="id_matrix_rows-__prefix__-next_question" class="w-full border-gray-300 rounded shadow-sm">
          <option value="">---------</option>
          {% for q in all_questions %}
            <option value="{{ q.id }}">{{ q.text|truncatewords:8 }}</option>
          {% endfor %}
        </select>
      </div>
    </div>
  </template>

  <div class="flex gap-3">
    <button type="button" data-prefix="matrix_rows" class="add-form-btn text-blue-600 px-3 py-1 border border-blue-600 rounded hover:bg-blue-100">
      ➕ Add Row
    </button>
    <button type="button" class="bulk-add-btn text-sm text-blue-700 underline" data-prefix="matrix_rows">
      Bulk Add
    </button>
  </div>
</div>

{# ------- MATRIX COLUMNS ------- #}
<div id="matrix-column-inline" class="space-y-4 hidden">
  <h2 class="text-lg font-medium text-gray-800">Matrix Columns</h2>
  {{ matrix_column_inline.management_form }}

  <div id="matrix_cols-forms" class="space-y-4">
    {% for form in matrix_column_inline %}
      <div class="p-4 border rounded bg-gray-50 dark:bg-gray-800 space-y-3">
        {% for field in form.visible_fields %}
          <div class="space-y-1">
            <label class="block text-sm font-medium dark:text-gray-200">{{ field.label }}</label>
            {{ field }}
            {% if field.help_text %}
              <p class="text-xs text-gray-500">{{ field.help_text }}</p>
            {% endif %}
          </div>
        {% endfor %}
      </div>
    {% endfor %}
  </div>

  <template id="matrix_cols-template">
    <div class="p-4 border rounded bg-gray-50 dark:bg-gray-800 space-y-3">
      <div class="space-y-1">
        <label for="id_matrix_cols-__prefix__-label" class="block text-sm font-medium dark:text-gray-200">Label</label>
        <input type="text" name="matrix_cols-__prefix__-label" id="id_matrix_cols-__prefix__-label" class="w-full border-gray-300 rounded shadow-sm">
      </div>
      <div class="space-y-1">
        <label for="id_matrix_cols-__prefix__-value" class="block text-sm font-medium dark:text-gray-200">Value</label>
        <input type="number" name="matrix_cols-__prefix__-value" id="id_matrix_cols-__prefix__-value" class="w-full border-gray-300 rounded shadow-sm">
      </div>
      <div class="space-y-1">
        <label for="id_matrix_cols-__prefix__-input_type" class="block text-sm font-medium dark:text-gray-200">Input Type</label>
        <select name="matrix_cols-__prefix__-input_type" id="id_matrix_cols-__prefix__-input_type" class="w-full border-gray-300 rounded shadow-sm">
          <option value="text">Text</option>
          <option value="select">Dropdown</option>
          <option value="radio">Radio</option>
          <option value="checkbox">Checkbox</option>
        </select>
      </div>
      <div class="space-y-1">
        <label for="id_matrix_cols-__prefix__-group" class="block text-sm font-medium dark:text-gray-200">Group</label>
        <input type="text" name="matrix_cols-__prefix__-group" id="id_matrix_cols-__prefix__-group" class="w-full border-gray-300 rounded shadow-sm">
      </div>
      <div class="space-y-1">
        <label for="id_matrix_cols-__prefix__-order" class="block text-sm font-medium dark:text-gray-200">Order</label>
        <input type="number" name="matrix_cols-__prefix__-order" id="id_matrix_cols-__prefix__-order" class="w-full border-gray-300 rounded shadow-sm">
      </div>
      <div class="space-y-1">
        <label for="id_matrix_cols-__prefix__-next_question" class="block text-sm font-medium dark:text-gray-200">Next Question</label>
        <select name="matrix_cols-__prefix__-next_question" id="id_matrix_cols-__prefix__-next_question" class="w-full border-gray-300 rounded shadow-sm">
          <option value="">---------</option>
          {% for q in all_questions %}
            <option value="{{ q.id }}">{{ q.text|truncatewords:8 }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="space-y-1">
        <label class="inline-flex items-center">
          <input type="checkbox" name="matrix_cols-__prefix__-required" id="id_matrix_cols-__prefix__-required" class="mr-2">
          Required
        </label>
      </div>
    </div>
  </template>

  <div class="flex gap-3">
    <button type="button" data-prefix="matrix_cols" class="add-form-btn text-blue-600 px-3 py-1 border border-blue-600 rounded hover:bg-blue-100">
      ➕ Add Column
    </button>
    <button type="button" class="bulk-add-btn text-sm text-blue-700 underline" data-prefix="matrix_cols">
      Bulk Add
    </button>
  </div>
</div>
