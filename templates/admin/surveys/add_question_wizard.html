{% extends "admin/wizard_base.html" %}
{% load static %}
{% load tailwind_tags %}


{% block content %}
<section class="min-h-screen w-full px-6 py-8 bg-gray dark:bg-gray-900">


  <div class="flex flex-col lg:flex-row gap-8 max-w-screen-xl mx-auto">

      <!-- LEFT: FORM (spans 2 cols) -->
      <div class="lg:w-2/3 w-full">
        <h1 class="text-2xl font-semibold text-gray-900 dark:text-white">{{ title }}</h1>
        <br>
        <form method="post" enctype="multipart/form-data" id="question-form" class="space-y-6">
          {% csrf_token %}
          {{ form.non_field_errors }}

            {# Row 1: Code (narrow) | Question type | Lookup #}
            <div id="wizard-row-1" class="flex items-end gap-8 mb-4">

              {# Code ‚Äî narrow, non-growing #}
              <div class="question-field code-field flex-none">
                <label for="{{ form.code.id_for_label }}" class="block text-sm font-medium text-white dark:text-gray-300 mb-1">
                  Code
                </label>
                {{ form.code }}
              </div>

              {# Question type ‚Äî grows to fill the middle #}
              <div class="question-field question_type-field flex-1 min-w-0">
                <label for="{{ form.question_type.id_for_label }}" class="block text-sm font-medium text-white dark:text-gray-300 mb-1">
                  Question type
                </label>
                {{ form.question_type }}
              </div>

              {# Lookup ‚Äî fixed width, pushed to the far right #}
              <div id="question_lookup_container"
                   class="lookup-field flex-none w-80 ml-auto"
                   data-endpoint="{% url 'surveys:admin_question_lookup' %}">
                <label for="question_lookup_search" class="block text-sm font-medium text-white dark:text-gray-300 mb-1">
                  Clone Existing Question
                </label>
                <div class="relative">
                  <input id="question_lookup_search" type="text" autocomplete="off"
                         placeholder="Type code or text to search‚Ä¶"
                         class="block w-full rounded border border-gray-300 bg-white shadow-sm
                                focus:border-indigo-500 focus:ring-indigo-500
                                dark:bg-gray-800 dark:text-gray-100 dark:border-gray-700"
                         aria-autocomplete="list" aria-controls="question_lookup_results" aria-expanded="false" />
                  <ul id="question_lookup_results"
                      class="absolute z-20 mt-1 w-full max-h-60 overflow-auto rounded-md border border-gray-200 bg-white shadow-lg
                             dark:bg-gray-900 dark:border-gray-700 hidden"
                      role="listbox"></ul>
                  <select id="question_lookup" class="hidden"><option value=""></option></select>
                </div>
              </div>
            </div>

            {# Row 2: Question text (fills) | Required switch (small, right) #}
            <div id="wizard-row-2" class="flex flex-col md:flex-row md:items-end gap-6 md:gap-8 mt-10 mb-0">

              {# Question text ‚Äî grows; full width on small, wide on md+ #}
              <div class="question-field text-field md:flex-1 min-w-0">
                <label for="{{ form.text.id_for_label }}" class="block text-sm font-medium text-white dark:text-gray-300 mb-1">
                  Question text
                </label>
                <div class="w-full">
                  {{ form.text }}
                </div>
                {% if form.text.help_text %}
                  <p class="text-xs text-white/80 dark:text-gray-400 mt-1">{{ form.text.help_text }}</p>
                {% endif %}
                {% for error in form.text.errors %}<p class="text-sm text-red-600">{{ error }}</p>{% endfor %}
              </div>

              {# Required ‚Äî fixed/compact on the right #}
              <div class="question-field required-field md:flex-none md:w-48 md:ml-auto">
                <label for="{{ form.required.id_for_label }}" class="block text-sm font-medium text-white dark:text-gray-300 mb-1">
                  Required
                </label>
                <div class="h-10 flex items-center justify-end">
                  {{ form.required }}
                </div>
                {% for error in form.required.errors %}<p class="text-sm text-red-600">{{ error }}</p>{% endfor %}
              </div>

            </div>

            {# Row 3: Helper text (1/2) | Media type + Upload (1/2) #}
            <div id="wizard-row-3" class="flex flex-col md:flex-row md:flex-wrap md:items-end gap-6 mt-0">

              {# Helper text ‚Äî half #}
              <div class="question-field helper_text-field compact md:basis-1/2 md:flex-[0_0_50%] min-w-0">
                <label for="{{ form.helper_text.id_for_label }}"
                       class="block text-xs font-medium text-white dark:text-gray-300 mb-0.5">
                  Helper text
                </label>
                <div class="w-full">{{ form.helper_text }}</div>
                {% if form.helper_text.help_text %}
                  <p class="text-[11px] leading-4 text-white/80 dark:text-white mt-1">{{ form.helper_text.help_text }}</p>
                {% endif %}
                {% for error in form.helper_text.errors %}<p class="text-sm text-red-600">{{ error }}</p>{% endfor %}
              </div>

              {# Media type ‚Äî quarter #}
              <div class="question-field helper_media_type-field compact md:basis-1/4 md:flex-[0_0_25%] min-w-0">
                <label for="{{ form.helper_media_type.id_for_label }}"
                       class="block text-xs font-medium text-white dark:text-gray-300 mb-0.5">
                  Media type
                </label>
                <div class="w-full">{{ form.helper_media_type }}</div>
                {% for error in form.helper_media_type.errors %}<p class="text-sm text-red-600">{{ error }}</p>{% endfor %}
              </div>

              {# Upload ‚Äî quarter #}
              <div class="question-field helper_media-field compact md:basis-1/4 md:flex-[0_0_25%] min-w-0">
                <label for="{{ form.helper_media.id_for_label }}"
                       class="block text-xs font-medium text-white dark:text-gray-300 mb-0.5">
                  Helper media
                </label>
                <div class="w-full">{{ form.helper_media }}</div>
                {% if form.helper_media.help_text %}
                  <p class="text-[11px] leading-4 text-white/80 dark:text-gray-400 mt-1">{{ form.helper_media.help_text }}</p>
                {% endif %}
                {% for error in form.helper_media.errors %}<p class="text-sm text-red-600">{{ error }}</p>{% endfor %}
              </div>

            </div>

            {% for field in form %}
              {% if field.name != 'code' and field.name != 'text' and field.name != 'question_type' and field.name != 'required' and field.name != 'helper_text' and field.name != 'helper_media' and field.name != 'helper_media_type' and field.name != 'next_question' %}
                <div class="mt-4 question-field {{ field.name }}-field">
                  <label for="{{ field.id_for_label }}" class="block text-sm font-medium text-white dark:text-gray-300">
                    {{ field.label }}
                  </label>
                  {{ field }}
                  {% if field.help_text %}<p class="text-xs text-white/80 dark:text-gray-400">{{ field.help_text }}</p>{% endif %}
                  {% for error in field.errors %}<p class="text-sm text-red-600">{{ error }}</p>{% endfor %}
                </div>
              {% endif %}
            {% endfor %}


          {% include 'admin/surveys/includes/inlines.html' %}

            <div id="wizard-actions" class="mt-8 flex flex-wrap gap-3 justify-between items-center">
              <a href="{% url 'admin:surveys_survey_change' survey.id %}" class="btn-link" role="button">
                <span class="btn-ui btn-secondary">‚Üê Back to survey</span>
              </a>

              <button type="submit" class="btn-shell">
                <span class="btn-ui btn-primary">üíæ Save Question</span>
              </button>
            </div>

        </form>

        {% include "admin/surveys/includes/partials/bulk_add_modal.html" %}
        {% include "admin/surveys/includes/partials/confirm_switch_modal.html" %}

      </div>
        <template id="preview-placeholder">
          <em class="text-indigo-400 dark:text-indigo-300 italic">
            Start typing or adding options to see a live preview...
          </em>
        </template>
      <!-- RIGHT: LIVE PREVIEW (1 col) -->
      <div class="lg:w-1/3 w-full border-l lg:pl-6 mt-8 lg:mt-0 ">
        <h2 class="text-xl font-semibold text-gray-900 dark:text-white">üîç Live Preview</h2>
        <div id="question-preview"
             data-placeholder="<em class='text-indigo-400 dark:text-indigo-300 italic bg-gray-900'>Start typing or adding options to see a live preview...</em>"
             class="bg-gray-50 dark:bg-gray-800 border rounded p-4 text-sm text-gray-700 dark:text-gray-200">
          <em class="text-indigo-400 dark:text-indigo-300 italic">Start typing or adding options to see a live preview...</em>
        </div>
      </div>
  </div>
</section>

{% endblock %}
