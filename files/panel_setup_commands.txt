# Django Panel Project Setup Commands (PostgreSQL, Redis, Celery)

## 1. Install Dependencies
pip install psycopg2-binary celery redis python-decouple django-celery-beat

## 2. PostgreSQL Setup
# Create PostgreSQL database (run in psql or pgAdmin)
CREATE DATABASE your_database_name;

# Install PostgreSQL adapter
pip install psycopg2-binary

# Run Django migrations
python manage.py makemigrations
python manage.py migrate

## 3. Redis Setup
# Install Redis (Windows: download from https://github.com/tporadowski/redis/releases)
# Start Redis server
redis-server

# Verify Redis is running
redis-cli ping  # Should return PONG

## 4. Celery Setup
# Activate virtual environment
.\venv\Scripts\activate

# Run Celery worker (use solo pool for Windows)
celery -A panel worker --loglevel=info --pool=solo

# Run Celery with debug logging (for troubleshooting)
celery -A panel worker --loglevel=debug --pool=solo

# Test Celery tasks
python manage.py shell
# In shell:
from surveys.tasks import send_survey_notification, send_survey_reminder
send_survey_notification.delay('test@example.com')
send_survey_reminder.delay('test@example.com', 'Annual Survey')

## 5. Celery Beat (Optional, for scheduled tasks)
# Install django-celery-beat
pip install django-celery-beat

# Add to INSTALLED_APPS in settings.py and run migrations
python manage.py migrate

# Start Celery Beat
celery -A panel beat --loglevel=info

## 6. Troubleshooting
# Clear Python cache
rmdir /s panel\__pycache__
rmdir /s panel\surveys\__pycache__

# Test Redis connection
python manage.py shell
# In shell:
import redis
r = redis.Redis(host='localhost', port=6379, db=0)
print(r.ping())  # Should print True

# Test email sending
python manage.py shell
# In shell:
from django.core.mail import send_mail
send_mail('Test', 'Test email', 'your_email@gmail.com', ['test@example.com'], fail_silently=False)

## 7. Production Considerations
# Install eventlet for better concurrency
pip install eventlet
celery -A panel worker --loglevel=info --pool=eventlet --concurrency=10

# Monitor tasks with Flower
pip install flower
celery -A panel flower